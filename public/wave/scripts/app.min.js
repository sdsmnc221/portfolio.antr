$(document).ready(function(){var e=["Chlore","OxyConcentration","Oxygene","pH","Pression","Salinite","TempeAir","TempeEau"],n={EN:["Chlorine","Saturation","Oxygene","pH","Pressure","Salinity","Air Temp.","Water Temp."],FR:["Chlore","Saturation","Oxygène","pH","Pression","Salinité","Temp. d'Air","Temp. d'Eau"],VI:["Clo","Độ bão hoà","Ôxy","pH","Áp suất","Nồng độ muối","Nhiệt độ không khí","Nhiệt độ nước"]},t="../scripts/api.php",a=3e4,i=n[$("html").attr("lang").trim().toUpperCase()];Barba.Pjax.init(),Barba.Prefetch.init(),Barba.Pjax.originalPreventCheck=Barba.Pjax.preventCheck,Barba.Pjax.preventCheck=function(e,n){return!!Barba.Pjax.originalPreventCheck(e,n)&&!(/vi/.test(n.href.toLowerCase())||/fr/.test(n.href.toLowerCase())||/en/.test(n.href.toLowerCase()))};var r=Barba.BaseTransition.extend({start:function(){Promise.all([this.newContainerLoading,this.fadeOut()]).then(this.fadeIn.bind(this))},fadeOut:function(){return $(this.oldContainer).animate({opacity:0}).promise()},fadeIn:function(){var e=this;url=window.location.href.slice(23),document.body.scrollTop=0,$(".nav-link-active").removeClass("nav-link-active"),$(".nav-link[href='"+url+"']").addClass("nav-link-active"),$(this.oldContainer).hide(),$(this.newContainer).css({visibility:"visible",opacity:0}),$(this.newContainer).animate({opacity:1},"slow",function(){e.done()})}}),o=function(){var e=window.location.href;return-1!==e.indexOf("en")?"en":-1!==e.indexOf("fr")?"fr":"vi"};function l(){$(".menu").css("transform","translateX(-110%)").removeClass("col-12 col-md-3 col-lg-2"),$("#barba-wrapper").removeClass("col-md-9 col-lg-10"),$(".header nav").css("margin-left","65px"),$(".header .controller__sidebar").removeClass("invisible")}function s(){$(".menu").addClass("col-12 col-md-3 col-lg-2").css("transform","translateX(0%)"),$("#barba-wrapper").addClass("col-md-9 col-lg-10"),$(".header nav").css("margin-left","0"),$(".header .controller__sidebar").addClass("invisible")}function d(){$(".app .controller__refresh").on("click",function(e){f()})}function c(){$(".card__infobox--temp").each(function(e,n){var t=-1===window.location.href.indexOf("details.html")?$(n).find("h3").first().text().trim():$(".controller__stats .dropdown-item.active").text().trim();-1===t.indexOf("Temp")&&-1===t.indexOf("Nhiệt độ")||$(n).attr("title",-1!==t.indexOf("Temp")?"Conversion Celsius <-> Farenheit":"Đổi Celsius <-> Farenheit").css("cursor","pointer").on("click",function(e){var n=$(e.currentTarget).find("p").first(),t=parseFloat(n.text().trim());-1!==n.text().indexOf("°C")?n.html((1.8*t+32).toFixed(2)+"<span class='unit'>°F</span"):n.html(((t-32)/1.8).toFixed(2)+"<span class='unit'>°C</span")})})}function f(){if($(".alert").remove(),$(".dim").remove(),$(".content").children().removeClass("blurred"),-1!==window.location.href.indexOf("details.html")){var n=$(".controller__stats .dropdown-toggle").text().trim();$.ajax({url:t,dataType:"json",data:{read_all:e[i.findIndex(function(e){return e===n})]}}).done(function(e){var t=e[0].Valeurs.toFixed(2),a=o();graphName="en"===a?"<h2>"+n+"'s Graph</h2>":"fr"===a?"<h2>Graphe : "+n+"</h2>":"<h2>Biểu đồ "+n+"</h2>",$(".card--current .card__infobox p").html(-1!==n.indexOf("Temp")||-1!==n.indexOf("Nhiệt độ")?t+"<span class='unit'>°C</span":-1!==n.indexOf("Press")||-1!==n.indexOf("Áp suất")?t+"<span class='unit'>pHa</span":t),$(".card--current .card__infobox h3").text(n.toUpperCase()),$($(".card__graph").siblings()[0]).html(graphName),u()}).fail(function(e){p()})}else $.ajax({url:t,dataType:"json",data:{read_lo:!0}}).done(function(n){$(".card__infobox").each(function(t,a){var r=$(a).find("h3").text().trim(),o=n.find(function(n){return n.type===e[i.findIndex(function(e){return e===r})]}).Valeurs.toFixed(2);$(a).find("p").html(-1!==r.indexOf("Temp")||-1!==r.indexOf("Nhiệt độ")?o+"<span class='unit'>°C</span":-1!==r.indexOf("Press")||-1!==r.indexOf("Áp suất")?o+"<span class='unit'>pHa</span":o)}),u()}).fail(function(e){p()});setTimeout(function(){f()},a)}function u(){var n=$(".controller__stats .dropdown-toggle").text().trim();$("");$("canvas#graph").hide("slow").remove(),$(".card__graph").append('<canvas id="graph"></canvas>'),function(n){var a=o();$.ajax({url:t,dataType:"json",data:{read_all:e[i.findIndex(function(e){return e===n})]}}).done(function(e){-1===window.location.href.indexOf("details.html")?h(e.slice(0,7)):h(e);var t=-1===window.location.href.indexOf("details.html")?m(e,7):m(e,e.length),i=$("#graph"),r={type:"line",labels:t.map(function(e){return e.x}),data:{datasets:[{data:t,label:n,borderColor:"#03A9F4",fill:!1}]},options:{title:{display:!0,text:"en"===a?"Last 7 "+n+" stats":"fr"===a?n+" - Les 7 dernières valeurs":"7 giá trị cuối cùng của "+n},scales:{xAxes:[{type:"time",time:{parser:"MM/DD/YYYY HH:mm",unit:"day",tooltipFormat:"ll HH:mm"},scaleLabel:{display:!1,labelString:"Date"}}],yAxes:[{scaleLabel:{display:!1,labelString:"Value"},ticks:{stepSize:v(t.map(function(e){return e.y}).sort().reverse()[0])/10,min:0,max:v(t.map(function(e){return e.y}).sort().reverse()[0])}}]}}};return new Chart(i,r)})}(n)}function p(){var e,n=document.createElement("div"),t=document.createElement("div"),a=o();e="en"===a?"No data. Refresh the page or check database connection.":"fr"===a?"Aucune donnée. Rechargez la page ou vérifiez la connexion vers la BDD.":"Không có dữ liệu. Tải lại trang hoặc kiểm tra kết nối với CSDL.",$(".content").children().addClass("blurred"),$(t).addClass("dimmed").appendTo($(".content")),$(n).addClass("alert alert-danger").attr("role","alert").html(e).appendTo($(".content"))}function h(e){var n="";e.forEach(function(e,t){n+="<tr>\n                <th scope='row'> "+(-1!==window.location.href.indexOf("detail.html")?e.ID:t+1)+" </th>\n                <td> "+e.Valeurs+" </td>\n                <td> "+x(e.time)+" </td>\n            </tr>"}),$("#table tbody").html(n),$("#table").parent().scrollTop(0)}function m(e,n){return e.slice(0,n).map(function(e){return{x:x(e.time),y:e.Valeurs}})}function x(e){return moment(e,"YYYY/MM/DD HH:mm").toDate()}function v(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return Math.ceil(e/n)*n}Barba.Pjax.getTransition=function(){return r},Barba.Dispatcher.on("initStateChange",function(){var e=window.location.href;i=-1!==e.indexOf("en")?n.EN:-1!==e.indexOf("fr")?n.FR:n.VI}),Barba.Dispatcher.on("transitionCompleted",function(){o(),d(),u(),-1===window.location.href.indexOf("contact.html")&&-1===window.location.href.indexOf("about.html")&&f()}),$(".app").on("click",".menu .controller__sidebar",l),$(".app").on("click",".header .controller__sidebar",s),$(window).width()<=425?l():s(),$(window).on("resize",function(){$(window).width()<=425?l():s()}),$(".dropdown-toggle").dropdown(),d(),c(),-1===window.location.href.indexOf("contact.html")&&-1===window.location.href.indexOf("about.html")&&f(),$(".app").on("click",".controller__stats button.dropdown-item",function(){var e=$(this).text().trim();$(".controller__stats .dropdown-toggle").text(e),$(".controller__stats .dropdown-menu .dropdown-item").each(function(n,t){$(t).removeClass("active"),$(t).text()===e&&$(t).addClass("active")}),u(),-1!==window.location.href.indexOf("details.html")&&(f(),-1!==e.indexOf("Temp")||-1!==e.indexOf("Nhiệt độ")?($(".card--current-value").addClass("card__infobox--temp"),c()):$(".card__infobox--temp").each(function(e,n){$(n).removeAttr("type").css("cursor","default").off("click").removeClass("card__infobox--temp")}))}),u()});